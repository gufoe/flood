<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <title></title>
        <style media="screen">
            body,
            html {
                width: 100%;
                height: 100%;
                margin: 0;
                padding: 0;
                border: 0;
                overflow: hidden;
            }
            body {
                background: #273134;
                color: #89c;
            }

            canvas {
                max-width: 100%;
            }

        </style>
        <script type="text/javascript">
            window.exports = window
        </script>
        <script src="lib/util.js" charset="utf-8"></script>
        <script src="lib/World.js" charset="utf-8"></script>
        <script src="lib/Net.js" charset="utf-8"></script>
        <script src="lib/Dna.js" charset="utf-8"></script>
        <script src="lib/flood.js" charset="utf-8"></script>
        <script type="text/javascript">
            var flood = new Flood({
                primero: (args, callback) => {
                    // Client
                    var pool = []
                    for (var i in args.pool)
                        pool.push(Dna.unserialize(args.pool[i]))

                    var w = new World()
                    w.init(pool, {
                        mix: 2,
                        canvas: util.query('draw') ? document.querySelector('#canvas') : null,
                        field: '.,.,.,.,.,.,.,.,.,.,.,.,.,.,.,.,.,.,.,.,.,x,x,x,x,x,.,x,x,x,x,x,x,.,x,x,x,x,x,.,.,x,.,.,.,.,.,x,x,x,x,x,x,.,.,.,.,.,x,.,.,x,.,x,x,x,.,.,.,x,x,.,.,.,x,x,x,.,x,.,.,.,.,.,.,x,x,x,.,x,x,.,x,x,x,.,.,.,.,.,.,x,x,x,.,x,.,.,.,.,.,.,.,.,x,.,x,x,x,.,.,.,.,x,.,x,.,x,x,x,x,x,x,.,x,.,x,.,.,.,x,x,.,x,.,.,.,x,x,x,x,x,x,.,.,.,x,.,x,x,.,.,.,x,x,x,.,x,x,x,x,x,x,.,x,x,x,.,.,.,.,x,.,.,.,.,.,.,.,.,.,.,.,.,.,.,.,.,x,.,.,x,x,x,.,x,x,x,x,x,x,x,x,x,x,.,x,x,x,.,.,x,x,x,.,.,.,.,.,.,.,.,.,.,.,.,x,x,x,.,.,x,x,x,.,x,x,x,.,x,x,.,x,x,x,.,x,x,x,.,.,.,.,.,.,.,.,.,.,x,x,.,.,.,.,.,.,.,.,.',
                        w: 20,
                        h: 14,
                        rounds: 100
                    })

                    var done = () => {
                        var best = w.best()
                        // console.log('updated', best.score())
                        callback(best)
                    }

                    if (util.query('draw')) {
                        var int = setInterval(() => {
                            if (!w.finished()) {
                                w.update()
                            } else {
                                console.log('done, best scored', w.best().score())
                                w.destroy()
                                done()
                                clearInterval(int)
                            }
                        }, 40)
                    } else {
                        while (true)
                            if (!w.finished()) {
                                w.update()
                            } else {
                                console.log('done, best scored', w.best().score())
                                w.destroy()
                                done()
                                break
                            }
                    }

                }
            })
            flood.start(util.query('s'))
        </script>
    </head>
    <body>
        <canvas id="canvas"></canvas>
    </body>
</html>